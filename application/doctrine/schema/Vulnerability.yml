Vulnerability:
    listeners: [IndexListener, NotificationListener]

    columns:
        createdTs: timestamp

        discoveredDate:
            type: date
            comment: The date when the finding was discovered. This is self-reported by scanners.
            extra:
                auditLog: true
                logicalName: Date Discovered
        closedTs:
            type: timestamp
            comment: The timestamp when this finding was closed
            extra:
                logicalName: Closed Date
        isResolved:
            type: boolean
            default: false
            notnull: true
            extra:
                auditLog: true
                logicalName: Vulnerability_Status
                searchIndex: unstored
            comment: The current status.
        description:
            type: string
            extra:
                purify: html
                auditLog: true
                logicalName: Vulnerability Description
                searchIndex: unstored
        recommendation:
            type: string
            extra:
                purify: html
                auditLog: true
                logicalName: Recommendation
                searchIndex: unstored
        threat:
            type: string
            extra:
                purify: html
                auditLog: true
                logicalName: Description of Threat Source
                searchIndex: unstored
            comment: Description of the threat source which affects this vulnerability
        threatLevel:
            type: enum
            values: [LOW, MODERATE, HIGH]
            extra:
                auditLog: true
                logicalName: Threat Level
                searchIndex: unstored
            comment: A subjective assessment of the probability and impact of exploiting this vulnerability
        cvssBaseScore:
           type: float
           extra:
                auditLog: true
                logicalName: CVSS Base Score
                searchIndex: unstored
           comment: The CVSS Base Score of the vulnerability
        cvssVector:
            type: string(255)
            comment: The CVSS Vector of the vulnerability
            extra:
                auditLog: true
                logicalName: CVSS Vector
                searchIndex: unstored
        assetId:
            type: integer
            comment: Foreign key to the asset which this vulnerability is against
            extra:
                logicalName: Affected Asset
                class: Asset
                field: addressIp
        createdByUserId:
            type: integer
            comment: Foreign key to the user who created this vulnerability
        resolutionId:
            type: integer
            comment: Foreign key to the user-defined resolution for the vulnerability
            extra:
                logicalName: Resolution
                class: VulnerabilityResolution
                field: name
        uploadIds:
            type: string
            comment: It contains a list of IDs of uploaded scan files
        bulkUploadIds:
            type: string
            comment: It contains a list of IDs of bulk uploaded scan files
        pocId:
            type: integer
            extra:
                notify: true
                class: User
                field: displayName
                auditLog: true
                logicalName: Vulnerability_Point_of_Contact
            comment: Foreign key to the point of contact for this vulnerability
        completedSteps: array
        currentStepId:
            type: integer
            extra:
                auditLog: true
                logicalName: Current Workflow Step
                class: WorkflowStep
                field: name
            comment: Foreign key to the current workflow step
        nextDueDate:
            type: date
            comment: The deadline date for the next action that needs to be taken on this finding. After this date, the finding is considered to be overdue.
            extra:
                logicalName: Workflow Due Date

    indexes:
        descriptionindex:
            fields:
                description:
                    length: 20

    relations:
        Asset:
            local: assetId
            foreign: id
            foreignAlias: Vulnerabilities
        CreatedBy:
            class: User
            local: createdByUserId
            foreign: id
            foreignAlias: Vulnerabilities
        Cves:
            class: Cve
            local: vulnerability_id
            foreign: cve_id
            refClass: VulnerabilityCve
        Bugtraqs:
            class: Bugtraq
            local: vulnerability_id
            foreign: bugtraq_id
            refClass: VulnerabilityBugtraq
        Xrefs:
            class: Xref
            local: vulnerability_id
            foreign: xref_id
            refClass: VulnerabilityXref
        Resolution:
            class: VulnerabilityResolution
            local: resolutionId
            foreign: id
            foreignType: one
        PointOfContact:
            class: User
            local: pocId
            foreign: id
            foreignAlias: Vulnerabilities
        CurrentStep:
            class: WorkflowStep
            local: currentStepId
            foreign: id
            foreignAlias: VulnerabilityCollection

    actAs:
        Timestampable:
            created:
                name: createdTs
                type: timestamp
            updated:
                name: modifiedTs
                type: timestamp

        Fisma_Doctrine_Behavior_AuditLoggable:
            logCreateObject: true
            logUpdateField: true
            logDeleteObject: true

        Fisma_Doctrine_Behavior_Commentable: true

        SoftDelete: true
