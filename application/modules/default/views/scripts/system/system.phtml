<div class="column left">
<?php
Fisma_Format_Section::startSection('General Information');
?>
<table class="keyValues">
    <tr>
        <td>System Name: </td>
        <td>
            <?php
            if ($this->acl()->hasPrivilegeForObject('update', $this->organization)) {
            ?>
            <span id="name" class="editable" target="name" name="name" type="text">
                <?php echo $this->escape($this->organization->name); ?>
            </span>
            <?php
            } else {
            ?>
            <span>
                <?php echo $this->escape($this->organization->name); ?>
            </span>
            <?php
            }
            ?>
        </td>
    </tr>
    <tr>
        <td>System Nickname: </td>
        <td>
            <?php
            if ($this->acl()->hasPrivilegeForObject('update', $this->organization)) {
            ?>
            <span id="nickname" class="editable" target="nickname" name="nickname" type="text">
                <?php echo $this->escape($this->organization->nickname); ?>
            </span>
            <?php
            } else {
            ?>
            <span>
                <?php echo $this->escape($this->organization->nickname); ?>
            </span>
            <?php
            }
            ?>
        </td>
    </tr>
    <tr>
        <td>System Type: </td>
        <td>
            <?php
            if ($this->acl()->hasPrivilegeForObject('update', $this->organization)) {
            ?>
                <span id="type" 
                      class="editable" 
                      target="type" 
                      name="type" 
                      type="select" 
                      href="/metainfo/list/o/systemType/format/html/">
                    <?php echo $this->escape($this->organization->getOrgTypeLabel()); ?>
                </span>
            <?php
            } else {
            ?>
            <span>
                <?php echo $this->escape($this->organization->getOrgTypeLabel()); ?>
            </span>
            <?php
            }
            ?>
        </td>
    </tr>
    <tr>
        <td>Mission Criticality: </td>
        <td>
            <?php
            if ($this->acl()->hasPrivilegeForObject('update', $this->organization)) {
            ?>
                <span id="missionCriticality" 
                      class="editable" 
                      target="missionCriticality" 
                      name="missionCriticality" 
                      type="select" 
                      value="<?php echo $this->escape($this->organization->System->missionCriticality);?>"
                      href="/metainfo/list/o/missionCriticality/format/html/">
                    <?php echo $this->escape($this->organization->System->missionCriticality); ?>
                </span>
            <?php
            } else {
            ?>
            <span>
                <?php echo $this->escape($this->organization->System->missionCriticality); ?>
            </span>
            <?php
            }
            ?>
        </td>
    </tr>
    <tr>
        <td>SDLC Phase: </td>
        <td>
            <?php
            if ($this->acl()->hasPrivilegeForObject('update', $this->organization)) {
            ?>
                <span id="sdlcPhase" 
                      class="editable" 
                      target="sdlcPhase" 
                      name="sdlcPhase" 
                      type="select" 
                      value="<?php echo $this->escape($this->organization->System->sdlcPhase);?>"
                      href="/metainfo/list/o/systemSdlcPhase/format/html/">
                    <?php echo $this->escape($this->organization->System->getSdlcPhaseLabel()); ?>
                </span>
            <?php
            } else {
            ?>
            <span>
                <?php echo $this->escape($this->organization->System->getSdlcPhaseLabel()); ?>
            </span>
            <?php
            }
            ?>
        </td>
    </tr>
    <tr>
        <td>E-Auth Level: </td>
        <td>
            <?php
            if ($this->acl()->hasPrivilegeForObject('update', $this->organization)) {
            ?>
                <span id="eAuthLevel" 
                      class="editable" 
                      target="eAuthLevel" 
                      name="eAuthLevel" 
                      type="select" 
                      value="<?php echo $this->escape($this->organization->System->eAuthLevel);?>"
                      href="/metainfo/list/o/eAuthLevel/format/html/">
                    <?php echo $this->escape($this->organization->System->getEAuthLevelLabel()); ?>
                </span>
            <?php
            } else {
            ?>
            <span>
                <?php echo $this->escape($this->organization->System->getEAuthLevelLabel()); ?>
            </span>
            <?php
            }
            ?>
        </td>
    </tr>
    <tr>
        <td>Parent Organization: </td>
        <td>
        <?php
            $parentOrganization = $this->organization->getNode()->getParent();
            $organizationTypeNickname = $parentOrganization->OrganizationType->nickname;  
            if (isset($parentOrganization)) {
                $parentOrganizationName = $parentOrganization->nickname . ' - ' . $parentOrganization->name;
                if ($this->acl()->hasPrivilegeForObject('read', $parentOrganization)) {
                    $parentOrgType = 'system' == $organizationTypeNickname ? 'system' : 'organization';
                    $parentOrganizationId = 'system' == $parentOrgType ? 
                                            $parentOrganization->systemId : $parentOrganization->id;
                    echo $this->escape('<a href="/' . $parentOrgType . '/view/id/', 'none');
                    echo $this->escape($parentOrganizationId, 'url');
                    echo $this->escape('">', 'none');
                    echo $this->escape($parentOrganizationName);
                    echo $this->escape('</a>', 'none');
                } else {
                    echo $this->escape($parentOrganizationName);
                }
            } else {
                echo $this->escape('<i>None</i>', 'none');
            }

        ?>
        </td>
    </tr>
</table>
</div>
<?php
Fisma_Format_Section::stopSection();?>

<div class="column right">
    <?php Fisma_Format_Section::startSection('Points of Contact'); ?>
    <?php Fisma_Format_Section::stopSection();?>
</div>

<div class="clear"></div>

<?php if ($this->acl()->hasPrivilegeForObject('update', $this->organization)) {
    Fisma_Format_Section::startSection('System Description', 'system_description');
} else {
    Fisma_Format_Section::startSection('System Description');
}
?>
<div name="description" id="system_description" type="textarea" rows="3" cols="120"> 
    <?php echo $this->escape($this->organization->description, 'none'); ?>
</div>
<?php Fisma_Format_Section::stopSection();

$environmentText = "<b>System Environment</b><p>Provide a general description of the technical system.  Include the "
    . "primary hardware, software, and communications equipment. Include any environmental or technical factors that "
    . "raise special security concerns, such as use of Personal Digital Assistants, wireless technology, etc.</p>";
$environmentTooltip = new Fisma_Yui_Tooltip('systemEnvironment', 'System Environment', $environmentText);

Fisma_Format_Section::startSection($environmentTooltip, 'system_environment');?>
<div name="environment" id="system_environment" type="textarea" rows="3" cols="120">
    <?php echo $this->escape($this->organization->System->environment, 'none'); ?>
</div>
<?php Fisma_Format_Section::stopSection();

$interconnectionText = "<b>System Interconnections</b><p>Document all of the information systems interconnections "
    . "here. A system interconnection is the direct connection of two or more IT systems for the purpose of sharing "
    . "information resources. An Interconnection Security Agreement (ISA), Memorandum of Understanding (MOU), or "
    . "Memorandum of Agreement (MOA) is needed between systems (not between workstations/desktops or publicly "
    . "accessed systems) that share data that are owned or operated by different organizations. An ISA is not "
    . "needed with internal agency systems if an agency manages and enforces a rigid system development life cycle, "
    . "which requires approvals and sign-offs ensuring compliance with security requirements. For additional "
    . "information on interconnections, see NIST SP 800-47, Security Guide for Interconnecting Information Technology "
    . "Systems.</p";

$interconnectionTooltip = new Fisma_Yui_Tooltip('systemInterconnection',
    'System Interconnections & Information Sharing', $interconnectionText);
Fisma_Format_Section::startSection($interconnectionTooltip, 'interconnections');?>
<div name="interconnections" id="interconnections" type="textarea" rows="3" cols="120">
    <?php if (is_null($this->system->interconnections)):
    echo '<table><tr><td><p>System</p><p>Name</p></td><td>Organization</td><td>Type</td><td>Agreement</td><td>Date</td>'
        . '<td><p>FIPS 199</p><p>Category</p></td><td><p>C&amp;A</p><p>Status</p></td><td><p>Auth.</p><p>Official</p>'
        . '</td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td>'
        . '<td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td>'
        . '<td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td>'
        . '<td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr></table>';
    else:
        echo $this->escape($this->system->interconnections, 'none');
    endif;?>
</div>

<?php
Fisma_Format_Section::stopSection();

Fisma_Format_Section::startSection('System Architecture', 'system_architecture'); ?>
<div name="architecture" id="system_architecture" type="textarea" rows="3" cols="120">
    <?php echo $this->escape($this->system->architecture, 'none'); ?>
</div>
<?php Fisma_Format_Section::stopSection();
