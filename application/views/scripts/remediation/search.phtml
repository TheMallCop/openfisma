<script language="javascript">
    $(document).ready(function(){
        highLight('poam_list', '<?php echo $this->keywords;?>');
    });
</script>
<?php
    $url = "/panel/remediation/sub/view";
    if (!empty($this->keywords)) {
        $url .= "/keywords/".$this->keywords;
    }
?>
<div class="barleft">
<div class="barright">
    <p><img style="cursor:pointer" src="/images/favor.gif" title="add to bookmark"
            onclick="addBookmark('OpenFisma Finding Result',
            '<?php echo Config_Fisma::readSysConfig('hostUrl').$this->url; ?>')"/>&nbsp;&nbsp;
    <b>Remediation Search Results</b>
        <span>
            <?php echo $this->links['all'];?>
        </span>
        <span>
            <a href="<?php echo $this->attachUrl;?>/format/pdf" ><img style="margin-top:2px;" border="0" src="/images/pdf.gif"/></a>
            <a href="<?php echo $this->attachUrl;?>/format/xls" ><img style="margin-top:2px;" border="0" src="/images/xls.gif"/></a>
            <a href="<?php echo $this->attachUrl;?>/format/rss" target="_blank"><img style="margin-top:2px;" border="0" src="/images/rss.jpg"/></a>
            <a href="#options" class="ph_sticky options" rel="#options" title="Show/Hide Columns">
                <img style="margin-top:2px;" border="0" src="/images/emblem-system.png"/>
            </a>
            <div id="options" style="display:none" />
        </span>
    </p>
</div>
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery('.tbframe').columnManager({listTargetID:'cluetip', onClass: 'accept', offClass: 'blank', 
                                      hideInList: [$(".tbframe tr th").length], saveState: true, 
                                      cookiePath: '/', onToggle: function(index, state){$.get('/user/preference');}});
    jQuery('#cluetip ul').css('background','#fff').css('margin','0').css('padding','0 2em 2em').css('z-index','100');
    jQuery('#cluetip-inner').css('border','none');
    jQuery('#cluetip li').css('list-style','none').css('position','relative');
});
</script>
</div>
    <table width="100%" class="tbframe" id="poam_rst">
        <tr>
            <th nowrap>ID 
                <a href="<?php echo $this->url;?>/sortby/p.id/order/ASC"><img src="/images/up_arrow.gif" border="0"></a>
                <a href="<?php echo $this->url;?>/sortby/p.id/order/DESC"><img src="/images/down_arrow.gif" border="0"></a>
            </th>
            <th nowrap>Source 
                <a href="<?php echo $this->url;?>/sortby/s.name/order/ASC"><img src="/images/up_arrow.gif" border="0"></a>
                <a href="<?php echo $this->url;?>/sortby/s.name/order/DESC"><img src="/images/down_arrow.gif" border="0"></a>
            </th>
            <th nowrap>System 
                <a href="<?php echo $this->url;?>/sortby/sys.name/order/ASC"><img src="/images/up_arrow.gif" border="0"></a>
                <a href="<?php echo $this->url;?>/sortby/sys.name/order/DESC"><img src="/images/down_arrow.gif" border="0"></a>
            </th>
            <th nowrap>Asset 
                <a href="<?php echo $this->url;?>/sortby/as.name/order/ASC"><img src="/images/up_arrow.gif" border="0"></a>
                <a href="<?php echo $this->url;?>/sortby/as.name/order/DESC"><img src="/images/down_arrow.gif" border="0"></a>
            </th>
            <th nowrap>Type 
                <a href="<?php echo $this->url;?>/sortby/p.type/order/ASC"><img src="/images/up_arrow.gif" border="0"></a>
                <a href="<?php echo $this->url;?>/sortby/p.type/order/DESC"><img src="/images/down_arrow.gif" border="0"></a>
            </th>
            <th nowrap>Status 
                <a href="<?php echo $this->url;?>/sortby/p.status/order/ASC"><img src="/images/up_arrow.gif" border="0"></a>
                <a href="<?php echo $this->url;?>/sortby/p.status/order/DESC"><img src="/images/down_arrow.gif" border="0"></a>
            </th>
            <th nowrap>On Time? </th>
            <th nowrap>Description </th>
            <th nowrap>Recommendation </th>
            <th nowrap>Corrective Action </th>
            <th nowrap>Blscr 
                <a href="<?php echo $this->url;?>/sortby/p.blscr_id/order/ASC"><img src="/images/up_arrow.gif" border="0"></a>
                <a href="<?php echo $this->url;?>/sortby/p.blscr_id/order/DESC"><img src="/images/down_arrow.gif" border="0"></a>
            </th>
            <th nowrap>Threat Level 
                <a href="<?php echo $this->url;?>/sortby/p.threat_level/order/ASC"><img src="/images/up_arrow.gif" border="0"></a>
                <a href="<?php echo $this->url;?>/sortby/p.threat_level/order/DESC"><img src="/images/down_arrow.gif" border="0"></a>
            </th>
            <th nowrap>Threat Description </th>
            <th nowrap>Cmeasures Effectiveness 
                <a href="<?php echo $this->url;?>/sortby/p.cmeasure_effectiveness/order/ASC"><img src="/images/up_arrow.gif" border="0"></a>
                <a href="<?php echo $this->url;?>/sortby/p.cmeasure_effectiveness/order/DESC"><img src="/images/down_arrow.gif" border="0"></a>
            </th>
            <th nowrap>Cmeasures Description </th>
            <th nowrap>Attachments </th>
            <th nowrap>ECD 
               <a href="<?php echo $this->url;?>/sortby/p.action_est_date/order/ASC"><img src="/images/up_arrow.gif" border="0"></a>
               <a href="<?php echo $this->url;?>/sortby/p.action_est_date/order/DESC"><img src="/images/down_arrow.gif" border="0"></a>
            </th>
            <th nowrap>View</th>
        </tr>
        <!-- REMEDIATION ROWS -->
        <tbody id = "poam_list">
        <?php
            foreach($this->list as $row){
        ?>
        <tr>
            <td align='center' class='tdc'><?php echo $row['id'];?></td>
            <td align='center' class='tdc' nowrap>
            <?php 
                    if (!isset($row['source_name'])) {
                        echo 'Missing Source id';
                    } else {
                        echo $row['source_name'];
                    }
            ?>
            </td>
            <td align='center' class='tdc'><?php echo '(' . $row['system_nickname'] . ')' . $row['system_name'];?></td>
            <td align='center' class='tdc' nowrap><?php echo $row['asset_name'];?></td>
            <td align='center' class='tdc' nowrap><?php echo $row['type'];?></td>
            <td align='center' class='tdc' nowrap><?php echo $row['status'];?></td>
            <td align='center' class='tdc' nowrap>
                <?php echo $this->isOnTime($row['duetime']);?>
            </td>
            <td align='left' class='tdc'><?php echo $this->ShowLongText($row['finding_data'], $this->keywords);?></td>
            <td align='left' class='tdc'><?php echo $this->ShowLongText($row['action_suggested'], $this->keywords);?></td>
            <td align='left' class='tdc'><?php echo $this->ShowLongText($row['action_planned'], $this->keywords);?></td>
            <td align='left' class='tdc'><?php echo $row['blscr_id'];?></td>
            <td align='left' class='tdc'><?php echo $row['threat_level'];?></td>
            <td align='left' class='tdc'><?php echo $this->showLongText($row['threat_source'], $this->keywords);?></td>
            <td align='left' class='tdc'><?php echo $row['cmeasure_effectiveness'];?></td>
            <td align='left' class='tdc'><?php echo $this->ShowLongText($row['cmeasure'], $this->keywords);?></td>
            <td align='center' class='tdc'><?php echo $row['attachments']?'Y':'N';?></td>
            <td align='center' class='tdc' nowrap><?php echo $row['action_current_date'];?></td> 
            <td align="center" valign='middle' class='tdc'><a href="<?php echo $url;?>/id/<?php echo $row['id'];?>"><img src="/images/view.gif" border="0"></a></td>
        </tr>
        <?php } ?>
        </tbody>
    </table>
