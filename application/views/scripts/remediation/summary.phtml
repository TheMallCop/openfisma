<?php
    $this->sources[0] = '--Any--';
    $this->systems[0] = '--Any--';
?>

<div class="barleft">
<div class="barright">
<p><b>Remediation Summary</b></p>
</div>
</div>
<p>
<form name="filters" method="post" action="/panel/remediation/sub/summary">
<!-- Begin Filter Table -->
<table align="center" border="0" cellpadding="3" cellspacing="1" width="95%" class="tipframe">
    <tr>
        <td><b>Finding Source: </b>
            <?php echo $this->formSelect('source_id',
                                         isset($this->criteria['sourceId'])?$this->criteria['sourceId']:0,
                                         null,
                                         $this->sources);?>
        </td>
        <td>
        <td ><b>Asset Owners: </b>
            <?php echo $this->formSelect('asset_owner',
                                         isset($this->criteria['assetOwner'])?$this->criteria['assetOwner']:0,
                                         null,
                                         $this->systems);?>
        </td>
        <td ><b>Action Owners: </b>
            <?php echo $this->formSelect('system_id',
                                         isset($this->criteria['systemId'])?$this->criteria['systemId']:0,
                                         null,
                                         $this->systems);?>
        </td>
        <td align="left"><input type='submit' value='Filter'></td>
    </tr>
</table>
</p>
<br>
<table align="center" class="tbframe" width="90%">
    <tr align="center">
        <th class="tdc"></th>
        <th colspan="<?php echo count($this->mpEvalList)+2;?>" class="tdc">Mitigation Strategy</th>
        <th colspan="<?php echo count($this->epEvalList)+1;?>" class="tdc">Remediation</th>
        <th colspan="2" class="tdc"></th>
    </tr>
    <tr align="center">
        <th class="tdc">Action Owner</th>
        <th class="tdc">New</th>
        <th class="tdc">Open</th>
<?php  
    foreach ($this->mpEvalList as $row) {
        $mpStatus[] = $row['nickname'];        
?>
        <th class="tdc"><?php echo $row['nickname'];?></th>
<?php } ?>
        <th class="tdc">EN</th>
<?php  
    foreach ($this->epEvalList as $row) { 
        $epStatus[] = $row['nickname'];    
?>
        <th class="tdc"><?php echo $row['nickname'];?></th>
<?php } ?>
        <th class="tdc">CLOSED</th>
        <th class="tdc">Total</th>
    </tr>

<!-- SUMMARY LOOP -->
<?php 
    define('BASE', "/panel/remediation/sub/searchbox/s/search");
    $statusArray = array();
    $statusArray = array_merge(array('NEW', 'OPEN'), $mpStatus);
    array_push($statusArray, 'EN');
    $statusArray = array_merge($statusArray, $epStatus);
    array_push($statusArray, 'CLOSED');

    foreach($this->summary as $sid=>$row){
        $base_url = BASE . '/system_id/' . $sid . $this->criteriaUrl;
        echo '<tr>';
        echo '<td width="25%" align="left" class="tdc">'.$this->systems[$sid].'</td>';

        foreach ($statusArray as $status) {
            echo '<td align="center" class="tdc">';
            echo $row[$status] == ''?'-':'<a href="'.$base_url.'/status/'.$status.'">'.$row[$status].'</a>';
            echo '</td>';
        }
        echo '<td align="center" class="tdc">';
        echo $row['TOTAL'] == ''?'-':'<a href="'.$base_url.'">'.$row['TOTAL'].'</a>';
        echo '</td></tr>';
    }

    if ($this->criteria['systemId'] == 0 ) {
        $base_url = BASE . $this->criteriaUrl;
    }
    
    echo '<tr>';
    echo '<td width="25%" align="center" class="tdc"><b>TOTALS</b></td>';
    foreach ($statusArray as $status) {
        echo '<td align="center" class="tdc">';
        echo $this->total[$status] == '0'?'<b>0</b>':'<a href="'.$base_url.'/status/'.$status.'"><b>'.$this->total[$status].'</b></a></b>';
        echo '</td>';
    }
    echo '<td align="center" class="tdc">';
    echo $this->total['TOTAL'] == '0'?'<b>0</b>':'<a href="'.$base_url.'"><b>'.$this->total['TOTAL'].'</b></a>';
    echo '</td></tr>';
?>
<!-- END SUMMARY LOOP -->
</table>
