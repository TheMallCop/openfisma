(function(){var a=function(e,b){this._stepTemplate=$("#"+b+" tr").first();this._addOptionsToRoleSelect(e.roles);var d=$("table.fisma_crud tr:last-child").first(),c=this;$.each(e.steps,function(f,g){c.addStepBelow(d,g);d=d.next()})};a.prototype={_stepTemplate:null,_addOptionsToRoleSelect:function(c){var b=$("select",this._stepTemplate);b.append("<option value=''></option>");$.each(c,function(d,e){b.append("<option value='"+d+"'>"+e+"</option>")})},_renumberSteps:function(){$("table.fisma_crud tr.incidentStep > td:first-child").text(function(b){return"Step "+(b+1)})},addStepAbove:function(c,b){this.addStepBelow($(c).prev().get(0),b);this._renumberSteps()},addStepBelow:function(f,e){var b=this._stepTemplate.clone(),d=$("button",b).get(),c;if(e){$("input",b).val(e.name);$("select",b).val(e.roleId);$("textarea",b).val(e.description)}c=function(){this.addStepAbove(b)};new YAHOO.widget.Button(d[0],{onclick:{fn:c,scope:this}});c=function(){this.addStepBelow(b)};new YAHOO.widget.Button(d[1],{onclick:{fn:c,scope:this}});c=function(){this.removeStep(b)};new YAHOO.widget.Button(d[2],{onclick:{fn:c,scope:this}});$(f).after(b);this._renumberSteps()},removeStep:function(b){$(b).remove();this._renumberSteps()}};Fisma.IncidentWorkflow=a}());