(function(){Fisma.PersistentStorage=function(a){Fisma.PersistentStorage.superclass.constructor.call(this,a)};YAHOO.extend(Fisma.PersistentStorage,Fisma.Storage,{_modified:null,set:function(a,b){if(this._modified===null){this._modified={}}this._modified[a]=b;return this._set(a,b)},init:function(a){for(var b in a){this._set(b,a[b])}},sync:function(d,e){var a=null,b=null,c=null;if(e){if(typeof(e)=="function"){a=e}else{if(e.success&&typeof(e.success)=="function"){a=e.success}}if(e.failure&&typeof(e.failure)=="function"){b=e.failure}if(e.scope){c=e.scope}}Fisma.Storage.onReady(function(){var g="/storage/sync/format/json",f=$('[name="csrf"]').val();e={scope:this,success:function(h){var i=YAHOO.lang.JSON.parse(h.responseText);if(i.status=="ok"){this.init(i.data);this._modified=null}if(a){a.call(c?c:this,h,i)}},failure:function(){if(b){b.call(c?c:this)}}},postData=$.param({csrf:f,namespace:this.namespace,updates:YAHOO.lang.JSON.stringify(this._modified),reply:d?YAHOO.lang.JSON.stringify(d):null});YAHOO.util.Connect.asyncRequest("POST",g,e,postData)},this,true)}})})();