Fisma.Search.Panel=function(f){var h;var b=f;if(0===b.length){throw"Field array cannot be empty"}b.sort(function(l,i){if(l.label<i.label){return -1}else{if(l.label>i.label){return 1}else{return 0}}});this.searchableFields=[];for(h in b){var c=b[h];if(c.hidden!==true){this.searchableFields[this.searchableFields.length]=c}}this.defaultQueryTokens=null;var a=document.location.search.substring(1);var d=a.split("&");for(var g in d){var k=d[g];var e=k.split("=");if("q"==e[0]){var j=e[1];this.defaultQueryTokens=j.split("/");if(this.defaultQueryTokens[0]===""){this.defaultQueryTokens.splice(0,1)}break}}};Fisma.Search.Panel.prototype={container:null,criteria:[],render:function(l){this.container=l;var c=YAHOO.util.Dom;var g=Fisma.Search.QueryState;var v=new g(c.get("modelName").value);if(this.defaultQueryTokens){var f=0;while(this.defaultQueryTokens.length>f){var b=this.defaultQueryTokens[f];f++;var h=this.defaultQueryTokens[f];f++;var n=this.getFieldDefinition(b);var s=new Fisma.Search.Criteria(this,this.searchableFields);var j=s.getCriteriaDefinition(n);var k=this.getNumberOfOperands(n,h,j);var e=[];for(;k>0;k--){e.push(this.defaultQueryTokens[f]);f++}var w=$P.array_map(decodeURIComponent,e);var t=s.render(b,h,w);this.container.appendChild(s.container);this.criteria.push(s)}if(1==this.criteria.length){this.criteria[0].setRemoveButtonEnabled(false)}Fisma.Search.toggleAdvancedSearchPanel();Fisma.Search.onSetTable(function(){var i=document.getElementById("searchForm");setTimeout(function(){Fisma.Search.executeSearch(i)},1)})}else{if(v.getSearchType()===g.TYPE_ADVANCED){var a=v.getAdvancedFields();var p=v.getAdvancedQuery();var u={};for(var r in p){u[p[r].field]=p[r].operands}for(var m in a){var o=a[m];var d=new Fisma.Search.Criteria(this,this.searchableFields);this.criteria.push(d);this.container.appendChild(d.render(m,o,u[m]))}Fisma.Search.toggleAdvancedSearchPanel();Fisma.Search.onSetTable(function(){var i=document.getElementById("searchForm");setTimeout(function(){Fisma.Search.executeSearch(i)},1)})}else{var x=new Fisma.Search.Criteria(this,this.searchableFields);this.criteria.push(x);var q=x.render(this.searchableFields[0].name);x.setRemoveButtonEnabled(false);this.container.appendChild(q)}}},addCriteria:function(b){if(1==this.criteria.length){this.criteria[0].setRemoveButtonEnabled(true)}if(!this.searchableFields[this.criteria.length]){throw"No field defined for search"}var d=new Fisma.Search.Criteria(this,this.searchableFields);this.criteria.push(d);var a=this.criteria.length-1;var c=d.render(this.searchableFields[a].name);this.container.insertBefore(c,b.nextSibling)},removeCriteria:function(b){for(var a in this.criteria){var c=this.criteria[a];if(c.container==b){this.criteria.splice(a,1);break}}if(1==this.criteria.length){this.criteria[0].setRemoveButtonEnabled(false)}this.container.removeChild(b)},getQuery:function(){var c=new Array();for(var a in this.criteria){var b=this.criteria[a];if(b.hasBlankOperands()){continue}c.push(b.getQuery())}return c},getFieldDefinition:function(b){for(var a in this.searchableFields){if(this.searchableFields[a].name==b){return this.searchableFields[a]}}throw"No definition for field: "+b},getNumberOfOperands:function(e,b,d){var a=d[b];if(!a){throw"No criteria defined for field ("+e.name+") and operator ("+b+")"}var c=a.query;switch(c){case"noInputs":return 0;break;case"enumSelect":case"oneInput":return 1;break;case"twoInputs":return 2;break;default:throw"Number of operands not defined for query function: "+c;break}throw"Number of operands not defined for query function: "+c}};