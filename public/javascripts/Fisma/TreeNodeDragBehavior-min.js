(function(){var a=function(b,e,d){this._callbacks=e;var c=e.dragFinished&&YAHOO.lang.isFunction(e.dragFinished.fn)&&YAHOO.lang.isValue(e.dragFinished.context);if(!c){throw"Required callback 'dragFinished' is not specified or is not valid."}this._dragDropGroup=YAHOO.util.Dom.generateId;this._treeView=b;a.superclass.constructor.call(this,d,this._dragDropGroup,null);YAHOO.util.Dom.addClass(this.getDragEl(),"treeNodeDragProxy")};YAHOO.lang.extend(a,YAHOO.util.DDProxy,{_treeView:null,_currentDragTarget:null,_currentDragSuccessful:false,_dragDropGroup:null,_callbacks:null,startDrag:function(c,e){var b=this.getDragEl();var d=this.getEl();b.innerHTML=d.innerHTML;YAHOO.util.Dom.setStyle(b,"background","white");YAHOO.util.Dom.setStyle(b,"border","none")},endDrag:function(d,f){var b=this.getEl();var c=this.getDragEl();YAHOO.util.Dom.removeClass(this._currentDragTarget,"treeNodeDragAbove");YAHOO.util.Dom.removeClass(this._currentDragTarget,"treeNodeDragOnto");YAHOO.util.Dom.removeClass(this._currentDragTarget,"treeNodeDragBelow");if(!this._currentDragSuccessful){YAHOO.util.Dom.setStyle(c,"visibility","");var e=new YAHOO.util.Motion(c,{points:{to:YAHOO.util.Dom.getXY(b)}},0.2,YAHOO.util.Easing.easeOut);e.onComplete.subscribe(function(){YAHOO.util.Dom.setStyle(c.id,"visibility","hidden")});e.animate();this._currentDragSuccessful=false}},onDragOver:function(b,g){var f=this._getDragLocation(g,b);this._currentDragTarget=YAHOO.util.Dom.get(g);YAHOO.util.Dom.removeClass(this._currentDragTarget,"treeNodeDragAbove");YAHOO.util.Dom.removeClass(this._currentDragTarget,"treeNodeDragOnto");YAHOO.util.Dom.removeClass(this._currentDragTarget,"treeNodeDragBelow");var d=this._treeView.getNodeByElement(this.getEl());var e=this._treeView.getNodeByElement(document.getElementById(g));if(this._callbacks.testDragTargetDelegate){var c=this._callbacks.testDragTargetDelegate.fn.call(this._callbacks.testDragTargetDelegate.context,d,e,f);if(c===false){return}}if(f==a.DRAG_LOCATION.ABOVE){YAHOO.util.Dom.addClass(this._currentDragTarget,"treeNodeDragAbove")}else{if(f==a.DRAG_LOCATION.ONTO){YAHOO.util.Dom.addClass(this._currentDragTarget,"treeNodeDragOnto")}else{YAHOO.util.Dom.addClass(this._currentDragTarget,"treeNodeDragBelow")}}},onDragOut:function(b,c){YAHOO.util.Dom.removeClass(this._currentDragTarget,"treeNodeDragAbove");YAHOO.util.Dom.removeClass(this._currentDragTarget,"treeNodeDragOnto");YAHOO.util.Dom.removeClass(this._currentDragTarget,"treeNodeDragBelow")},onDragDrop:function(b,h){var d=this._treeView.getNodeByElement(this.getEl());var f=this._treeView.getNodeByElement(document.getElementById(h));var g=this._getDragLocation(h,b);if(this._callbacks.testDragTargetDelegate){var c=this._callbacks.testDragTargetDelegate.fn.call(this._testDragTargetDelegateContext,d,f,g);if(c===false){return}}var e=this._callbacks.dragFinished.fn.call(this._callbacks.dragFinished.context,this,d,f,g);this._currentDragSuccessful=e},completeDragDrop:function(b,c,d){this._treeView.popNode(b);switch(d){case Fisma.TreeNodeDragBehavior.DRAG_LOCATION.ABOVE:b.insertBefore(c);break;case Fisma.TreeNodeDragBehavior.DRAG_LOCATION.ONTO:b.appendTo(c);break;case Fisma.TreeNodeDragBehavior.DRAG_LOCATION.BELOW:b.insertAfter(c);break;default:throw"Invalid drag location parameter";break}this._treeView.getRoot().refresh();Fisma.TreeNodeDragBehavior.makeTreeViewDraggable(this._treeView,this._callbacks)},_getDragLocation:function(c,f){var g=YAHOO.util.Dom.getRegion(c);var b=g.bottom-g.top;var e=YAHOO.util.Event.getPageY(f)-g.top;var d=e/b;if(d<0.25){return a.DRAG_LOCATION.ABOVE}else{if(d<0.75){return a.DRAG_LOCATION.ONTO}else{return a.DRAG_LOCATION.BELOW}}}});a.makeTreeViewDraggable=function(d,f){var c=d.getNodesBy(function(h){return true});for(var g in c){var e=c[g];var b=new a(d,f,e.contentElId,this._dragDropGroup)}};a.DRAG_LOCATION={ABOVE:0,ONTO:1,BELOW:2};Fisma.TreeNodeDragBehavior=a})();