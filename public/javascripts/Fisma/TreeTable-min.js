(function(){var a=function(c,b){this._dataUrl=c;this._numberColumns=b;this._buttons=[{label:"Expand All",fn:this.expandAllNodes,image:"/images/expand.png"},{label:"Collapse All",fn:this.collapseAllNodes,image:"/images/collapse.png"},{label:"Export PDF",fn:function(){alert("NOT IMPLEMENTED")},image:"/images/pdf.gif"}];a.superclass.constructor.call(this)};a.NodeState={EXPANDED:"EXPANDED",COLLAPSED:"COLLAPSED",LEAF_NODE:"LEAF_NODE"};YAHOO.lang.extend(a,Object,{_buttons:null,_dataUrl:null,_defaultDisplayLevel:2,_loadingBar:null,_numberColumns:null,_table:null,_treeData:null,render:function(b){var d=document.createElement("div");d.className="searchBox";b.appendChild(d);this._renderButtons(d);var f=document.createElement("table");f.className="treeTable";b.appendChild(f);this._table=f;var e=document.createElement("tr");this._renderHeader(e);f.appendChild(e);var c=document.createElement("tr");this._renderLoadingBar(c);f.appendChild(c);this._loadingBar=c;this._requestData()},toggleNode:function(c,b){switch(b.state){case a.NodeState.EXPANDED:this._setNodeState(b,a.NodeState.COLLAPSED);break;case a.NodeState.COLLAPSED:this._setNodeState(b,a.NodeState.EXPANDED);break;case a.NodeState.LEAF_NODE:throw"Cannot toggle a leaf node's state";break;default:throw"Unexpected node state ("+b.state+")"}},collapseSubtree:function(c){if(c.state==a.NodeState.EXPANDED){this._setNodeState(c,a.NodeState.COLLAPSED)}if(YAHOO.lang.isValue(c.children)&&c.children.length>0){for(var b in c.children){this.collapseSubtree(c.children[b])}}},collapseAllNodes:function(){for(var c in this._treeData){var b=this._treeData[c];this.collapseSubtree(b);this._hideChildren(b)}},expandSubtree:function(c){if(c.state==a.NodeState.COLLAPSED){this._setNodeState(c,a.NodeState.EXPANDED)}if(YAHOO.lang.isValue(c.children)&&c.children.length>0){for(var b in c.children){this.expandSubtree(c.children[b])}}},expandAllNodes:function(){for(var c in this._treeData){var b=this._treeData[c];this.expandSubtree(b)}},reloadTable:function(){alert("THIS IS OLD CODE AND DOESNT WORK");return;var c=document.getElementById("loadingRow");c.style.display="";var b=document.getElementById("summaryTable");while(b.rows.length>4){b.deleteRow(b.rows.length-1)}YAHOO.util.Connect.asyncRequest("GET",url,{success:function(e){var d=YAHOO.lang.JSON.parse(e.responseText);this._hideLoadingBar();summary.render("summaryTable",d,true)},failure:function(e){var d="Unable to load finding summary: "+e.statusText;Fisma.Util.showAlertDialog(d);this._hideLoadingBar()}},null)},_renderButtons:function(b){var e,d;for(var c in this._buttons){d=this._buttons[c];e=new YAHOO.widget.Button({type:"button",container:b,label:d.label,onclick:{fn:d.fn,scope:this}});e._button.style.background="url("+d.image+") 10% 50% no-repeat";e._button.style.paddingLeft="3em"}},_renderHeader:function(c){var b=document.createElement("th");b.appendChild(document.createTextNode("Override the _renderHeader method!"));c.appendChild(b)},_renderCell:function(b,e,d,c){b.appendChild(document.createTextNode("Override the _renderCell method!"))},_renderLoadingBar:function(e){var c=document.createElement("th");c.colSpan=10;e.appendChild(c);var d=document.createElement("p");d.appendChild(document.createTextNode("Loadingâ€¦"));c.appendChild(d);var b=document.createElement("img");b.src="/images/loading_bar.gif";c.appendChild(b)},_requestData:function(){YAHOO.util.Connect.asyncRequest("GET",this._dataUrl,{success:this._handleDataRefresh,failure:this._handleDataRefreshFailed,scope:this},null)},_handleDataRefresh:function(c){this._treeData=YAHOO.lang.JSON.parse(c.responseText);for(var d=0;d<this._treeData.length;d++){var b=this._treeData[d];this._preprocessTreeData(b);this._renderNode(b,0);this._setInitialTreeState(b,0)}this._hideLoadingBar()},_handleDataRefreshFailed:function(b){this._hideLoadingBar();Fisma.Util.showAlertDialog("Unable to load finding summary: "+b.statusText)},_preprocessTreeData:function(b){},_renderNode:function(c,e){c.row=document.createElement("tr");this._table.appendChild(c.row);if(YAHOO.lang.isValue(c.children)&&c.children.length>0){c.expandedRow=document.createElement("tr");this._renderNodeState(c.expandedRow,c,e,a.NodeState.EXPANDED);this._table.appendChild(c.expandedRow);c.collapsedRow=document.createElement("tr");this._renderNodeState(c.collapsedRow,c,e,a.NodeState.COLLAPSED);this._table.appendChild(c.collapsedRow)}else{c.leafNodeRow=document.createElement("tr");this._renderNodeState(c.leafNodeRow,c,e,a.NodeState.LEAF_NODE);this._table.appendChild(c.leafNodeRow)}for(var d=0;d<c.children.length;d++){var b=c.children[d];this._renderNode(b,e+1)}},_renderNodeState:function(c,e,b,j){var k=document.createElement("td");c.appendChild(k);var g=document.createElement("div");g.className="treeTable"+b;k.appendChild(g);if(j!=a.NodeState.LEAF_NODE){g.className+=" link"}var d=document.createElement("img");d.className="control";var h=document.createElement("span");h.appendChild(d);switch(j){case a.NodeState.EXPANDED:YAHOO.util.Event.addListener(g,"click",this.toggleNode,e,this);d.src="/images/minus.png";break;case a.NodeState.COLLAPSED:YAHOO.util.Event.addListener(g,"click",this.toggleNode,e,this);d.src="/images/plus.png";break;case a.NodeState.LEAF_NODE:d.src="/images/leaf_node.png";break;default:throw"Unexpected nodeState ("+j+")"}g.appendChild(h);this._renderCell(g,e.nodeData,0,j);for(var f=1;f<this._numberColumns;f++){k=document.createElement("td");this._renderCell(k,e.nodeData,f,j);c.appendChild(k)}},_setInitialTreeState:function(c,e){if(YAHOO.lang.isValue(c.children)&&c.children.length>0){for(var b in c.children){var d=c.children[b];this._setInitialTreeState(d,e+1)}if(e<this._defaultDisplayLevel-1){this._setNodeState(c,a.NodeState.EXPANDED)}else{this._setNodeState(c,a.NodeState.COLLAPSED)}}else{this._setNodeState(c,a.NodeState.LEAF_NODE)}},_setNodeState:function(b,c){if(b.state!=a.NodeState.LEAF_NODE){switch(c){case a.NodeState.EXPANDED:b.collapsedRow.style.display="none";b.expandedRow.style.display="";this._showChildren(b);break;case a.NodeState.COLLAPSED:b.collapsedRow.style.display="";b.expandedRow.style.display="none";this._hideChildren(b);break;case a.NodeState.LEAF_NODE:break;default:throw"Unexpected node state ("+c+")"}b.state=c}else{throw"Cannot change state on a leaf node"}},_hideRow:function(b){if(YAHOO.lang.isValue(b.collapsedRow)){b.collapsedRow.style.display="none"}if(YAHOO.lang.isValue(b.expandedRow)){b.expandedRow.style.display="none"}if(YAHOO.lang.isValue(b.leafNodeRow)){b.leafNodeRow.style.display="none"}},_showRow:function(b){switch(b.state){case a.NodeState.EXPANDED:b.expandedRow.style.display="";break;case a.NodeState.COLLAPSED:b.collapsedRow.style.display="";break;case a.NodeState.LEAF_NODE:b.leafNodeRow.style.display="";break;default:throw"Unexpected node state ("+b.state+")"}},_hideChildren:function(c){if(YAHOO.lang.isValue(c.children)&&c.children.length>0){for(var b in c.children){var d=c.children[b];this._hideRow(d);this._hideChildren(d)}}},_showChildren:function(c){if(YAHOO.lang.isValue(c.children)&&c.children.length>0){for(var b in c.children){var d=c.children[b];this._showRow(d);if(d.state===a.NodeState.EXPANDED){this._showChildren(d)}}}},_hideLoadingBar:function(){this._loadingBar.style.display="none"}});Fisma.TreeTable=a})();